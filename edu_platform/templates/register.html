<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <title>EduTest - –¢—ñ—Ä–∫–µ–ª—É</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #ffffff, #f4f4f4);
    }

    header {
      background-color: #ffffff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      color: #2c3e50;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .flag-select {
      position: relative;
    }

    .flag-btn {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 20px;
    }

    .flag-dropdown {
      display: none;
      position: absolute;
      top: 30px;
      right: 0;
      background-color: white;
      border: 1px solid #ccc;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      z-index: 10;
    }

    .flag-dropdown button {
      display: block;
      width: 100%;
      padding: 5px 10px;
      background: none;
      border: none;
      text-align: left;
      font-size: 20px;
      cursor: pointer;
    }

    .flag-dropdown button:hover {
      background-color: #f0f0f0;
    }

    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 80vh;
    }

    .form-box {
      background: white;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 0 10px #aaa;
      max-width: 400px;
      width: 100%;
    }

    .form-box h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #2c3e50;
    }

    .form-box input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }

    .form-box button {
      width: 100%;
      padding: 10px;
      background-color: #7bed9f;
      color: #000000;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    .form-box p {
      text-align: center;
      margin-top: 15px;
    }

    .form-box p a {
      color: #7bed9f;
      text-decoration: none;
      font-weight: bold;
    }
  </style>

  <!-- Firebase SDK-–ª–∞—Ä—ã -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>

<body onload="loadLanguage()">

  <header>
    <div>EduTest</div>
    <div class="flag-select">
      <button class="flag-btn" onclick="toggleDropdown()" id="current-flag">üá∞üáø</button>
      <div class="flag-dropdown" id="flag-dropdown">
        <button onclick="changeLanguage('kk')">üá∞üáø</button>
        <button onclick="changeLanguage('ru')">üá∑üá∫</button>
        <button onclick="changeLanguage('en')">üá¨üáß</button>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="form-box">
      <h2 data-key="register_title">–¢—ñ—Ä–∫–µ–ª—É</h2>
      <form id="registerForm" method="post">
        {% csrf_token %}
        <input type="text" name="name" id="nameInput" placeholder="–ê—Ç—ã-–∂”©–Ω—ñ" required />
        <input type="email" name="email" id="emailInput" placeholder="Email" required />
        <input type="password" name="password" id="passwordInput" placeholder="“ö“±–ø–∏—è—Å”©–∑" required />
        <input type="text" name="city" id="cityInput" placeholder="“ö–∞–ª–∞" required />
        <button type="submit" data-key="register_btn">–¢—ñ—Ä–∫–µ–ª—É</button>
      </form>
      <p>
        <span data-key="have_account">–ê–∫–∫–∞—É–Ω—Ç—ã“£—ã–∑ –±–∞—Ä –º–∞?</span>
        <a href="{% url 'login' %}" data-key="login_link">–ö—ñ—Ä—É</a>
      </p>
    </div>
  </div>

  <script>
    // --- –¢—ñ–ª –∞—É–¥–∞—Ä–º–∞–ª–∞—Ä—ã ---
    const translations = {
      kk: {
        register_title: "–¢—ñ—Ä–∫–µ–ª—É",
        register_btn: "–¢—ñ—Ä–∫–µ–ª—É",
        have_account: "–ê–∫–∫–∞—É–Ω—Ç—ã“£—ã–∑ –±–∞—Ä –º–∞?",
        login_link: "–ö—ñ—Ä—É",
        name_placeholder: "–ê—Ç—ã-–∂”©–Ω—ñ",
        email_placeholder: "Email",
        password_placeholder: "“ö“±–ø–∏—è—Å”©–∑",
        city_placeholder: "“ö–∞–ª–∞"
      },
      ru: {
        register_title: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
        register_btn: "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è",
        have_account: "–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?",
        login_link: "–í–æ–π—Ç–∏",
        name_placeholder: "–§–ò–û",
        email_placeholder: "Email",
        password_placeholder: "–ü–∞—Ä–æ–ª—å",
        city_placeholder: "–ì–æ—Ä–æ–¥"
      },
      en: {
        register_title: "Register",
        register_btn: "Register",
        have_account: "Already have an account?",
        login_link: "Login",
        name_placeholder: "Full Name",
        email_placeholder: "Email",
        password_placeholder: "Password",
        city_placeholder: "City"
      }
    };

    function changeLanguage(lang) {
      localStorage.setItem("lang", lang);
      applyTranslations(lang);
      const flagMap = { kk: 'üá∞üáø', ru: 'üá∑üá∫', en: 'üá¨üáß' };
      document.getElementById('current-flag').textContent = flagMap[lang];
      document.getElementById('flag-dropdown').style.display = 'none';
    }

    function toggleDropdown() {
      const dropdown = document.getElementById('flag-dropdown');
      dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    }

    document.addEventListener('click', function(event) {
      const flagDropdown = document.getElementById('flag-dropdown');
      const currentFlag = document.getElementById('current-flag');
      if (!flagDropdown.contains(event.target) && !currentFlag.contains(event.target)) {
        flagDropdown.style.display = 'none';
      }
    });

    function applyTranslations(lang) {
      document.querySelectorAll("[data-key]").forEach(el => {
        const key = el.getAttribute("data-key");
        el.textContent = translations[lang][key];
      });

      document.getElementById("nameInput").placeholder = translations[lang].name_placeholder;
      document.getElementById("emailInput").placeholder = translations[lang].email_placeholder;
      document.getElementById("passwordInput").placeholder = translations[lang].password_placeholder;
      document.getElementById("cityInput").placeholder = translations[lang].city_placeholder;
    }

    function loadLanguage() {
      const lang = localStorage.getItem("lang") || "kk";
      applyTranslations(lang);
      const flagMap = { kk: 'üá∞üáø', ru: 'üá∑üá∫', en: 'üá¨üáß' };
      document.getElementById("current-flag").textContent = flagMap[lang];
    }

    // --- Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Å—ã ---
    const firebaseConfig = {
      'apiKey': "AIzaSyAClsdr7MwNndWFc7_L-BlZRNLeMjsxxxQ",
  'databaseURL': "https://bilimdi-platform.firebaseio.com",
  'authDomain': "edication-ce7a0.firebaseapp.com",
  'projectId': "edication-ce7a0",
  'storageBucket': "edication-ce7a0.firebasestorage.app",
  'messagingSenderId': "336523450386",
  'appId': "1:336523450386:web:c63104c263520f594c60cb",
  'measurementId': "G-GLKBYPXMPC"
    };

    // Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è—Å—ã
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- –¢—ñ—Ä–∫–µ–ª—É —Ñ–æ—Ä–º–∞—Å—ã–Ω ”©“£–¥–µ—É ---
    document.getElementById('registerForm').addEventListener('submit', function(e) {
      e.preventDefault(); // —Ñ–æ—Ä–º–∞ –∂—ñ–±–µ—Ä—É–¥—ñ —Ç–æ“õ—Ç–∞—Ç—É

      const name = document.getElementById('nameInput').value.trim();
      const email = document.getElementById('emailInput').value.trim();
      const password = document.getElementById('passwordInput').value;
      const city = document.getElementById('cityInput').value.trim();

      if (!name || !email || !password || !city) {
        alert("–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑.");
        return;
      }

      // Firebase Authentication –∞—Ä“õ—ã–ª—ã “õ–æ–ª–¥–∞–Ω—É—à—ã–Ω—ã —Ç—ñ—Ä–∫–µ—É
      auth.createUserWithEmailAndPassword(email, password)
        .then(userCredential => {
          const user = userCredential.user;

          // “ö–æ–ª–¥–∞–Ω—É—à—ã –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä—ñ–Ω Firestore-“ì–∞ —Å–∞“õ—Ç–∞—É
          return db.collection('users').doc(user.uid).set({
            uid: user.uid,
            name: name,
            email: email,
            city: city,
            role: "student", // ”ò–¥–µ–ø–∫—ñ —Ä”©–ª
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        })
        .then(() => {
          alert("–¢—ñ—Ä–∫–µ–ª—É —Å”ô—Ç—Ç—ñ ”©—Ç—Ç—ñ!");
          // –ü—Ä–æ—Ñ–∏–ª—å –±–µ—Ç—ñ–Ω–µ –±–∞“ì—ã—Ç—Ç–∞—É
          window.location.href = "/login"; // –Ω–µ–º–µ—Å–µ ”©–∑ –∂–æ–ª—ã“£—ã–∑“ì–∞ –∞—É—ã—Å—Ç—ã—Ä—ã“£—ã–∑
        })
        .catch(error => {
          alert("“ö–∞—Ç–µ: " + error.message);
        });
    }); 
  </script>
</body>
</html>

