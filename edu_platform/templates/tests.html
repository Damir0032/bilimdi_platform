<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>–¢–µ—Å—Ç—Ç–µ—Ä</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #ffffff;
      color: #000000;
      margin: 20px;
    }
    h1 {
      text-align: center;
    }
    .btn {
      background-color: #38a169;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 5px;
      margin: 5px;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #2f855a;
    }
    .test-card {
      border: 2px solid #9ae6b4;
      border-radius: 8px;
      padding: 16px;
      margin: 10px 0;
      background-color: #ffffff;
    }
    .hidden {
      display: none;
    }
    .question {
      margin: 10px 0;
    }
    .result-chart {
      max-width: 300px;
      margin: 20px auto;
    }
    .lang-select {
      float: right;
    }
    .flag-select {
            position: relative;
        }

        .flag-btn {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 20px;
        }

        .flag-dropdown {
            display: none;
            position: absolute;
            top: 30px;
            right: 0;
            background-color: white;
            border: 1px solid #ccc;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .flag-dropdown button {
            display: block;
            width: 100%;
            padding: 5px 10px;
            background: none;
            border: none;
            text-align: left;
            font-size: 20px;
            cursor: pointer;
        }

        .flag-dropdown button:hover {
            background-color: #f0f0f0;
        }
  </style>
</head>
<body>

  <h1>–¢–µ—Å—Ç—Ç–µ—Ä</h1>
  <div class="flag-select">
    <button class="flag-btn" onclick="toggleDropdown()" id="current-flag">üá∞üáø</button>
    <div class="flag-dropdown" id="flag-dropdown">
        <button onclick="changeLanguage('kk')">üá∞üáø</button>
        <button onclick="changeLanguage('ru')">üá∑üá∫</button>
        <button onclick="changeLanguage('en')">üá¨üáß</button>
    </div>
</div>

  <button class="btn" onclick="toggleAddTest()">+ –¢–µ—Å—Ç “õ–æ—Å—É</button>

  <div id="addTestSection" class="hidden">
    <h3>–¢–µ—Å—Ç “õ–æ—Å—É</h3>
    <input type="text" id="testTitle" placeholder="–¢–∞“õ—ã—Ä—ã–ø" />
    <input type="text" id="aiKey" placeholder="–ò–ò –∫—ñ–ª—Ç—ñ (“õ–∞–ª–∞—Å–∞“£—ã–∑)" />
    <button class="btn" onclick="addTestAI()">–ò–ò –∞—Ä“õ—ã–ª—ã “õ–æ—Å—É</button>
    <button class="btn" onclick="addTestManual()">“ö–æ–ª–º–µ–Ω “õ–æ—Å—É</button>
    <div id="manualQuestions" class="hidden">
      <h4>–°“±—Ä–∞“õ—Ç–∞—Ä –º–µ–Ω –∂–∞—É–∞–ø—Ç–∞—Ä</h4>
      <div id="questionsContainer"></div>
      <button class="btn" onclick="addManualQuestion()">–°“±—Ä–∞“õ “õ–æ—Å—É</button>
      <button class="btn" onclick="finalizeManualTest()">–°–∞“õ—Ç–∞—É</button>
    </div>
  </div>

  <hr>

  <div id="testList"></div>

  <canvas id="resultChart" class="result-chart hidden"></canvas>

  <script>
    let currentLang = 'kk';
    const translations = {
      kk: {
        addTest: "–¢–µ—Å—Ç—Ç–µ—Ä",
        topic: "–¢–∞“õ—ã—Ä—ã–ø",
        addAI: "–ò–ò –∞—Ä“õ—ã–ª—ã “õ–æ—Å—É",
        addManual: "“ö–æ–ª–º–µ–Ω “õ–æ—Å—É",
        addQuestion: "–°“±—Ä–∞“õ “õ–æ—Å—É",
        save: "–°–∞“õ—Ç–∞—É",
        answer: "–ñ–∞—É–∞–ø",
        correct: "–î“±—Ä—ã—Å –∂–∞—É–∞–ø",
        result: "–ù”ô—Ç–∏–∂–µ"
      },
      ru: {
        addTest: "–¢–µ—Å—Ç—ã",
        topic: "–¢–µ–º–∞",
        addAI: "–î–æ–±–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ –ò–ò",
        addManual: "–î–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é",
        addQuestion: "–î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å",
        save: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
        answer: "–û—Ç–≤–µ—Ç",
        correct: "–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç",
        result: "–†–µ–∑—É–ª—å—Ç–∞—Ç"
      },
      en: {
        addTest: "Tests",
        topic: "Topic",
        addAI: "Add with AI",
        addManual: "Add Manually",
        addQuestion: "Add Question",
        save: "Save",
        answer: "Answer",
        correct: "Correct Answer",
        result: "Result"
      }
    };

    function changeLanguage(lang) {
    document.querySelectorAll('[data-key]').forEach(el => {
        const key = el.getAttribute('data-key');

        if (key === 'welcome') {
            el.innerHTML = translations[lang][key].replace(/\n/g, '<br>');
        } else if (el.placeholder !== undefined) {
            el.placeholder = translations[lang][key];
        } else {
            el.textContent = translations[lang][key];
        }
    });

    const flagMap = { kk: 'üá∞üáø', ru: 'üá∑üá∫', en: 'üá¨üáß' };
    document.getElementById('current-flag').textContent = flagMap[lang];
    document.getElementById('flag-dropdown').style.display = 'none';
}


        function toggleDropdown() {
            const dropdown = document.getElementById('flag-dropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        document.addEventListener('click', function(event) {
            const flagDropdown = document.getElementById('flag-dropdown');
            const currentFlag = document.getElementById('current-flag');
            if (!flagDropdown.contains(event.target) && !currentFlag.contains(event.target)) {
                flagDropdown.style.display = 'none';
            }
        });


    function toggleAddTest() {
      document.getElementById('addTestSection').classList.toggle('hidden');
    }

    function addTestCard(test) {
      const card = document.createElement('div');
      card.className = 'test-card';
      card.innerHTML = `<h3>${test.title}</h3><button class="btn" onclick='startTest(${JSON.stringify(test.questions)})'>–ë–∞—Å—Ç–∞—É</button>`;
      document.getElementById('testList').appendChild(card);
    }

    function addTestAI() {
      const title = document.getElementById('testTitle').value;
      const key = document.getElementById('aiKey').value;
      if (!title || !key) return alert("–¢–∞“õ—ã—Ä—ã–ø –∂”ô–Ω–µ –ò–ò –∫—ñ–ª—Ç “õ–∞–∂–µ—Ç");

      // –£–∞“õ—ã—Ç—à–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (—à—ã–Ω–∞–π—ã –ò–ò API –æ—Ä–Ω—ã–Ω–∞)
      const questions = [];
      for (let i = 1; i <= 10; i++) {
        questions.push({
          question: `${title} - ${i}-—Å“±—Ä–∞“õ`,
          options: ["A", "B", "C", "D"],
          answer: "A"
        });
      }

      addTestCard({ title, questions });
    }

    function addTestManual() {
      document.getElementById('manualQuestions').classList.remove('hidden');
      document.getElementById('questionsContainer').innerHTML = '';
      addManualQuestion(); // –∞–ª“ì–∞—à“õ—ã —Å“±—Ä–∞“õ
    }

    function addManualQuestion() {
      const container = document.getElementById('questionsContainer');
      const index = container.children.length + 1;
      const div = document.createElement('div');
      div.className = 'question';
      div.innerHTML = `
        <input type="text" placeholder="–°“±—Ä–∞“õ ${index}" class="q-text" />
        <br>
        <input type="text" placeholder="A" class="opt" />
        <input type="text" placeholder="B" class="opt" />
        <input type="text" placeholder="C" class="opt" />
        <input type="text" placeholder="D" class="opt" />
        <input type="text" placeholder="–î“±—Ä—ã—Å –∂–∞—É–∞–ø (A/B/C/D)" class="ans" />
      `;
      container.appendChild(div);
    }

    function finalizeManualTest() {
      const title = document.getElementById('testTitle').value;
      if (!title) return alert("–¢–∞“õ—ã—Ä—ã–ø—Ç—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑");
      const container = document.getElementById('questionsContainer');
      const questions = [];

      for (const q of container.children) {
        const qText = q.querySelector('.q-text').value;
        const opts = Array.from(q.querySelectorAll('.opt')).map(o => o.value);
        const ans = q.querySelector('.ans').value;
        if (!qText || opts.some(o => !o) || !ans) return alert("–ë–∞—Ä–ª—ã“õ —Å“±—Ä–∞“õ—Ç–∞—Ä –º–µ–Ω –∂–∞—É–∞–ø—Ç–∞—Ä–¥—ã —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑");
        questions.push({ question: qText, options: opts, answer: ans });
      }

      addTestCard({ title, questions });
      document.getElementById('manualQuestions').classList.add('hidden');
    }

    function startTest(questions) {
      let correct = 0;
      let total = questions.length;

      for (const q of questions) {
        const user = prompt(q.question + "\n" + q.options.join(", "));
        if (user && user.toUpperCase() === q.answer.toUpperCase()) {
          correct++;
        }
      }

      showResultChart(correct, total);
    }

    function showResultChart(correct, total) {
      const ctx = document.getElementById('resultChart');
      ctx.classList.remove('hidden');

      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['–î“±—Ä—ã—Å', '“ö–∞—Ç–µ'],
          datasets: [{
            data: [correct, total - correct],
            backgroundColor: ['#38a169', '#feb2b2']
          }]
        }
      });
    }
  </script>

</body>
</html>
